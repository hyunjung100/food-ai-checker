<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI ìŒì‹ ë¶€íŒ¨ íŒë³„ê¸°</title>
  <!-- TensorFlow JS -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <!-- Teachable Machine Image -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <style>
    body { font-family: 'Malgun Gothic', sans-serif; text-align: center; padding: 20px; }
    video, canvas { width: 300px; height: auto; border: 1px solid #ccc; margin-top: 10px; }
    .result { font-size: 20px; margin-top: 10px; }
    input { padding: 5px; font-size: 16px; width: 100px; }
    #finalMessage { font-weight: bold; margin-top: 15px; color: darkred; }
    p.notice { font-size: 14px; color: gray; margin: 5px 0; }
  </style>
</head>
<body>
  <h2>ğŸ½ï¸ AI ìŒì‹ ë¶€íŒ¨ íŒë³„ê¸°</h2>
  <p>â–¶ ì¹´ë©”ë¼ ì‹¤í–‰ì„ ëˆŒëŸ¬ ìŒì‹ì„ ì¸ì‹í•˜ì„¸ìš”</p>
  <button type="button" onclick="init()">â–¶ ì¹´ë©”ë¼ ì‹¤í–‰</button>
  <p class="notice">â€» ì¹´ë©”ë¼ ì‹¤í–‰ ì‹œ, ë¸Œë¼ìš°ì €ì—ì„œ ê¶Œí•œ í—ˆìš©ì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  <div id="webcam-container"></div>

  <div class="result">
    <p>ğŸ§  <strong>ë¶„ì„ ê²°ê³¼:</strong> <span id="label"></span></p>
    <p>ğŸ‘ƒ <label for="gas">ì„¼ì„œ ìˆ˜ì¹˜ ì…ë ¥:</label>
       <input type="number" id="gas" placeholder="ì˜ˆ: 290" /></p>
    <button onclick="checkResult()">ğŸ½ï¸ ë©”ì‹œì§€ í™•ì¸</button>
    <div id="finalMessage"></div>
  </div>

  <script type="text/javascript">
    let model, webcam, maxPredictions;
    let currentLabel = "";

    const URL = "https://teachablemachine.withgoogle.com/models/DCFQawZzH/";

    async function init() {
      // ë¸Œë¼ìš°ì € ì§€ì› ì—¬ë¶€ í™•ì¸
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        document.getElementById('finalMessage').innerText = 'í˜„ì¬ ë¸Œë¼ìš°ì €ëŠ” ì¹´ë©”ë¼ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome ë˜ëŠ” Firefoxë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.';
        return;
      }

      // ëª¨ë¸ ë¡œë”© ì•ˆë‚´
      document.getElementById('finalMessage').innerText = 'ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
      try {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
      } catch (e) {
        document.getElementById('finalMessage').innerText = 'ëª¨ë¸ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        console.error(e);
        return;
      }

      // ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ë° ìŠ¤íŠ¸ë¦¼ ì„¤ì •
      try {
        webcam = new tmImage.Webcam(300, 300, true);
        await webcam.setup(); // ê¶Œí•œ ìš”ì²­
        await webcam.play();
        document.getElementById('finalMessage').innerText = '';
        const container = document.getElementById('webcam-container');
        container.innerHTML = '';
        container.appendChild(webcam.canvas);
        window.requestAnimationFrame(loop);
      } catch (e) {
        document.getElementById('finalMessage').innerText = 'ì¹´ë©”ë¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.';
        console.error(e);
      }
    }

    async function loop() {
      webcam.update();
      await predict();
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      prediction.sort((a, b) => b.probability - a.probability);
      const className = prediction[0].className;
      if (className === "A") currentLabel = "ì‹ ì„ ";
      else if (className === "B") currentLabel = "ì£¼ì˜";
      else if (className === "C") currentLabel = "ìœ„í—˜";
      else currentLabel = className;
      document.getElementById("label").innerText = currentLabel;
    }

    function checkResult() {
      const gasInput = document.getElementById("gas").value;
      const gas = parseInt(gasInput);
      let message = "";
      if (gasInput === "" || isNaN(gas)) {
        if (currentLabel === "ì‹ ì„ ") message = "ë§›ìˆê²Œ ë“œì„¸ìš”.";
        else if (currentLabel === "ì£¼ì˜") message = "ê´œì°®ì•„ ë³´ì—¬ë„ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else if (currentLabel === "ìœ„í—˜") message = "ì ˆëŒ€ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else message = "ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
      } else {
        if (currentLabel === "ì‹ ì„ " && gas < 280) message = "ë§›ìˆê²Œ ë“œì„¸ìš”.";
        else if (currentLabel === "ì£¼ì˜" && gas >= 280 && gas <= 300) message = "ê´œì°®ì•„ ë³´ì—¬ë„ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else if (currentLabel === "ìœ„í—˜" && gas > 300) message = "ì ˆëŒ€ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else message = "âš ï¸ AI ë¶„ì„ ê²°ê³¼ì™€ ì„¼ì„œ ìˆ˜ì¹˜ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì£¼ì˜í•˜ì„¸ìš”.";
      }
      document.getElementById("finalMessage").innerText = message;
    }
  </script>
</body>
</html>
