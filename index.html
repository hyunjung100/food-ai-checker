<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI ìŒì‹ ë¶€íŒ¨ íŒë³„ê¸°</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
  <style>
    body { font-family: 'Malgun Gothic', sans-serif; text-align: center; padding: 20px; }
    video { width: 300px; height: auto; border: 1px solid #ccc; margin-top: 10px; }
    .result { font-size: 20px; margin-top: 10px; }
    input { padding: 5px; font-size: 16px; width: 100px; }
  </style>
</head>
<body>
  <h2>ğŸ½ï¸ AI ìŒì‹ ë¶€íŒ¨ íŒë³„ê¸°</h2>
  <button type="button" onclick="init()">â–¶ ì¹´ë©”ë¼ ì‹¤í–‰</button><br>
  <video id="webcam" autoplay playsinline></video>

  <div class="result">
    <p><strong>ğŸ§  ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼:</strong> <span id="label"></span></p>
    <label for="gas">ğŸ‘ƒ ì„¼ì„œ ìˆ˜ì¹˜ ì…ë ¥:</label>
    <input type="number" id="gas" placeholder="ì˜ˆ: 290" />
    <button onclick="checkResult()">ğŸ½ï¸ ë©”ì‹œì§€ í™•ì¸</button>
    <p id="finalMessage" style="font-weight: bold; color: darkred;"></p>
  </div>

  <script type="text/javascript">
    let model, webcam, labelContainer, maxPredictions;
    let currentLabel = "";

    const URL = "https://teachablemachine.withgoogle.com/models/DCFQawZzH/";

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      const flip = true;
      webcam = new tmImage.Webcam(300, 300, flip);
      await webcam.setup();
      await webcam.play();
      window.requestAnimationFrame(loop);

      document.getElementById("webcam").appendChild(webcam.canvas);
    }

    async function loop() {
      webcam.update();
      await predict();
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      prediction.sort((a, b) => b.probability - a.probability);
      currentLabel = prediction[0].className;
      document.getElementById("label").innerText = currentLabel;
    }

    function checkResult() {
      const gas = parseInt(document.getElementById("gas").value);
      let message = "";

      if (!gas && gas !== 0) {
        // ì„¼ì„œ ìˆ˜ì¹˜ê°€ ì—†ì„ ê²½ìš°, ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼ë§Œ ì‚¬ìš©
        if (currentLabel === "A") message = "ë§›ìˆê²Œ ë“œì„¸ìš”.";
        else if (currentLabel === "B") message = "ê´œì°®ì•„ ë³´ì—¬ë„ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else if (currentLabel === "C") message = "ì ˆëŒ€ ë¨¹ì§€ ë§ˆì„¸ìš”.";
      } else {
        if (currentLabel === "A" && gas < 280) message = "ë§›ìˆê²Œ ë“œì„¸ìš”.";
        else if (currentLabel === "B" && gas >= 280 && gas <= 300) message = "ê´œì°®ì•„ ë³´ì—¬ë„ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else if (currentLabel === "C" && gas > 300) message = "ì ˆëŒ€ ë¨¹ì§€ ë§ˆì„¸ìš”.";
        else message = "âš ï¸ AI ë¶„ì„ ê²°ê³¼ì™€ ì„¼ì„œ ìˆ˜ì¹˜ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì£¼ì˜í•˜ì„¸ìš”.";
      }

      document.getElementById("finalMessage").innerText = message;
    }
  </script>
</body>
</html>